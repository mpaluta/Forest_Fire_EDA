---
title: "Forest_Fire_Initial"
author: "Debalina Maiti, Mark Paluta, Tina Agarwal, Vivek Agarwal"
date: "5/24/2018"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Introduction

This analysis is motivated by the following research question:

\begin{center}
What factors lead to particularly damaging forest fires?
\end{center}

## Setup

First, we load the car library, which gives us a convenient scatterplotMatrix function and the data set.

```{r car, results='hide'}
library(car)
forest_fire = read.table("forestfires.csv", header=TRUE, sep=",", na.string = "na")
```

## Data Overview

We note that we have 517 observations and 13 variables

```{r shape}
nrow(forest_fire)
str(forest_fire)
summary(forest_fire)
```

%% Comment: It might be a good idea to check all columns for na values up here near the top to get it over with %%

```{r}
for (name in names(forest_fire)){
  cat("NAs in " , name , " = " , sum(is.na(forest_fire[,name])),"\n" )
  }
```
No NAs in the dataset. Hooray!!


## Transformations
```{r}

forest_fire$sorted_day<-factor(forest_fire$day, levels = c("mon","tue","wed","thu","fri","sat","sun" ))

forest_fire$fire_size <- cut(forest_fire$area, breaks=c(-Inf,0.01, 25, Inf), labels=c('Low','Medium','High'))

forest_fire$dotsize<-NA
forest_fire[forest_fire$fire_size=="Medium",]$dotsize<-2
forest_fire[forest_fire$fire_size=="High",]$dotsize<-5
forest_fire[forest_fire$fire_size=="Low",]$dotsize<-1

Med_High_fire <- forest_fire[forest_fire$fire_size != "Low",]

forest_fire$month = factor(forest_fire$month,levels(forest_fire$month)[c(5,4,8,1,9,7,6,2,12,11,10,3)])
pdfire<-forest_fire[forest_fire$fire_size=="High",] #particularly damaging fire
```

# Univariate Analysis of Key Variables

We have a large number of variables, we begin with a scatterplot matrix. This is helpful for getting
a high-level overview of the relationships between our variables and can draw our attention to important
features we want to investigate further.

```{r}
#scatterplotMatrix(~ RH + wind + rain + logarea, data=forest_fire, smooth = TRUE, main = "Scatterplot Matrix for Relative Humidity, Wind and Rain")
```

## Area

%% Comment: need to address log(0) values being dropped %%

Area seems to be right skewed. To normalize the data, we could take the log of area.

```{r}
forest_fire$logarea = log(forest_fire$area)
hist(forest_fire$area)
hist(forest_fire$logarea)
```

However, as a signficant portion of our area data is zero and has an undefined logarithm, we also look at an approach of transforming area into a factor of low, medium, or high fire level.

Note: the mean fire area is 12.85.

For the rows with area = 0, we will populate the level value as 'low'
For the rows with 0 < area < 12.85, we will populate the level value as 'medium'
For the rows with area >= 12.85, we will populate the level value as 'high'

```{r}

## Case High

case_high = subset(forest_fire, 12.85<=forest_fire$area &!is.na(forest_fire$area))
case_high["level"]<- "high"

nrow(case_high)##high count = 76

## Case Medium

case_medium = subset(forest_fire, 0<forest_fire$area & forest_fire$area<12.85 &!is.na(forest_fire$area))
case_medium["level"]<- "medium"

nrow(case_medium)##medium count = 194

## Case Low

case_low = subset(forest_fire, forest_fire$area==0 &!is.na(forest_fire$area))
case_low["level"]<- "low"

nrow(case_low)##low count = 247

###Merge all three to ff_level

ff_level = merge(case_high, case_medium, all = TRUE)
ff_level = merge(case_low, ff_level, all = TRUE)

####Logarithm - looking at the data against area we see that there are huge number of data with value zero. So will replace area value with log(area) value
#
#ff_level$area = log(ff_level$area) - Vivek - suggest we don't overwrite an existing variable. We already have larea to store log of area.
#str(ff_level)
```

<!-- #Plot X, Y  -->
<!-- ```{r} -->
<!-- plot(jitter(ff_level$X, factor=2),jitter(ff_level$Y, factor=2 ), col = factor(ff_level$level)) -->
<!-- legend(1, legend=levels(factor(ff_level$level)), col= factor(ff_level$level)) -->
<!-- legend=levels(ff_level$level) -->
<!-- ``` -->

## Spatial coordinates (X & Y)

%% This might below in next section: Analysis of Key Relationships %%

Plotting the coordinates on a grid, we can see that some areas of the grid are densely populated with data and other areas are sparse. The colors represent size of the fire.

```{r}

########## replace this filler breakdown with Debalina's high/medium/low breakdown - Done (Vivek) #############3

forest_fire$fire_size <- cut(forest_fire$area, breaks=c(-0.01,0.01, 25, Inf), labels=c('Low','Medium','High'))
plot(jitter(forest_fire$X, factor=2.5), jitter(forest_fire$Y, factor=2.5), col=forest_fire$fire_size)
legend(1,9,unique(forest_fire$fire_size),col=1:length(forest_fire$fire_size),pch=1)
```

```{r}

########## replace this filler breakdown with Debalina's high/medium/low breakdown - Done (Vivek) #############3


plot(jitter(forest_fire$X, factor=2.5), jitter(forest_fire$Y, factor=2.5), col=forest_fire$fire_size, cex=forest_fire$dotsize)
legend(1,9,unique(forest_fire$fire_size),col=1:length(forest_fire$fire_size),pch=1)
```

## Month

A histogram shows that most of the data comes from spring and summer months. We can use box plots of month and log of area to see the distributions of burned area by month.

```{r}

barplot(table(forest_fire$month))
library(ggplot2)
ggplot(data = forest_fire, aes(x = month, y = logarea)) + geom_boxplot(aes(fill = logarea), width = 0.8) + theme_bw()
```

##DC

```{r}
# Let's take a look at DC index
summary(ff_level$DC)

# Here is the histogram of DC index

hist(ff_level$DC, main = "Drought Code", 
     xlab = NULL)
axis(1, at = 0:9)

# Plot DC and Burned Area

plot(jitter(forest_fire$DC, factor=2),jitter(forest_fire$logarea, factor=2 ),
     col=factor(forest_fire$fire_size),
     xlab = "DC", ylab = "area",
     main = "Relation between DC and area")
legend=levels(ff_level$fire_size)

#Observation: Could not find very distinctive feature. But for 600 <= Drought Code <=800, fire tendency is high
```

##ISI

```{r}
# Now we will check ISI index

summary(forest_fire$ISI)

# Here is the histogram of ISI index

hist(forest_fire$ISI, main = "Initial Spread Index", 
     xlab = NULL)
axis(1, at = 0:6)

# Plot ISI and Burned Area

plot(jitter(forest_fire$ISI, factor=2),jitter(forest_fire$logarea, factor=2 ),
     col=factor(forest_fire$fire_size),
     xlab = "ISI", ylab = "area",
     main = "Relation between ISI and area")
legend=levels(ff_level$fire_size)

#Observation: Fire tendency is highest when ISI is from 5 to 15
```

##Temperature

```{r}
#How temperature data looks like. First looking at the summary:

summary(forest_fire$temp)

# Here is the histogram of Temperature in Celcius

hist(forest_fire$temp, main = "Temperature in Celcius", 
     xlab = NULL)
axis(1, at = 0:10)

# Let's plot temperature and burned area

plot(jitter(log(forest_fire$temp), factor=2),jitter(forest_fire$logarea, factor=2 ),
     col=factor(forest_fire$fire_size),
     xlab = "log(temp)", ylab = "area",
     main = "Relation between temperature and area")
legend=levels(forest_fire$fire_size)

#Observation: Maximum fire incident occurs when temperature is in between 15 - 25

```

## Wind

Below is a histogram of wind.

```{r}
summary(forest_fire$wind)

hist(forest_fire$wind,breaks=seq(0.4,9.4,0.5),main = "Wind Speed",xlab= NULL)
```

Visually, the histogram seems to have a positive skew (right skew). This means that there are
observations stretching further to the right of the bulk of the data. Note from summary that the mean is greater than the median, which is typically what we see for positively skewed variables.

## Relative Humidity

Next we look at a histogram of Relative humidity

```{r}
summary(forest_fire$RH)
hist(forest_fire$RH,breaks=seq(15,100,5),main = "Percentage of Relative Humidity",xlab= "RH in %")
```

Again, we see the same evidence of right skew as in wind speed.

## Rain

We next examine our Rain variable. We notice that it is mostly 0's.

```{r}
summary(forest_fire$rain)
hist(forest_fire$rain, breaks=seq(0.0,6.4,0.2), main = "Outside rain in mm/m2", xlab = "Rain in mm/m2" )
```

The distribution seems to spike around zero, which means that there was no rain at all.

#boxplot
```{r}
#boxplot(rain ~ RH ~ logarea, data = forest_fire)
```

#FFMD, DMC and day

```{r}

#plot(forest_fire$fire_size, forest_fire$FFMC^10/factorial(10), xlab= 'Fire Size', ylab = 'Transformed FFMC')

ggplot(Med_High_fire, aes(x=log(area), y=FFMC^10/factorial(10)) ) +geom_point()  + labs(x="Log of area", y="FFMC")+geom_smooth(method="lm", se=F)

```
FFMC seems to have no bearing on the size of the fire.

```{r}
plot(forest_fire$fire_size, forest_fire$DMC, xlab= 'Fire Size', ylab = 'DMC')
```
DMC seems to have no relationship to the size of the fire.

```{r}

#plot(log(Med_High_fire$area), Med_High_fire$DMC, xlab= 'Fire Size', ylab = 'DMC')
ggplot(Med_High_fire, aes(x=log(area), y=DMC^2) ) +geom_point()  + labs(x="Log of area", y="Square of DMC") + geom_smooth(method='lm', se=F)

```
Even after scaling the variables, slope is barely perceptible

```{r}
ggplot(forest_fire, aes(sorted_day, ..count..))+geom_bar(aes(fill=fire_size), position = "dodge") + labs(x="Day of the week") + labs( y="Count of fires")
```
Friday, Saturday and Sunday seem to have seen more fires overall. Saturday and Sunday have seen more large fires

```{r}
ggplot(forest_fire, aes(month, ..count..))+geom_bar(aes(fill=sorted_day)) + labs(x="month") + labs( y="Count of fires")

# + facet_grid (fire_size~.)

```


```{r}
plot(forest_fire$month, forest_fire$temp)

# + facet_grid (fire_size~.)

```

```{r}

scatterplotMatrix(~RH+FFMC+DMC+ISI+DC+month+logarea, data=pdfire)  

```
# Analysis of Key Relationships
```{r}

ggplot(pdfire, aes(x=DC, y=logarea)) + geom_point() + geom_smooth(method = 'lm', se = F)

```

```{r}
ggplot(pdfire, aes(x=DMC, y=logarea)) + geom_point() + geom_smooth(method = 'lm', se = F)
```

```{r}
ggplot(pdfire, aes(x=RH, y=logarea)) + geom_point() + geom_smooth(method = 'lm', se = F)
```


# Analysis of Secondary Effects
```{r}
ggplot(pdfire, aes(x=DC, y=DMC)) + geom_point() + geom_smooth(method = 'lm', se = F)
```

```{r}
ggplot(pdfire, aes(x=DMC, y=RH)) + geom_point() + geom_smooth(method = 'lm', se = F)
```

```{r}
ggplot(pdfire, aes(x=DC, y=RH)) + geom_point() + geom_smooth(method = 'lm', se = F)
```

# Conclusion


